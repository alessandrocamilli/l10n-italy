<openerp>
	<data>
		<menuitem id="of_wt_main" name="Withholding tax" 
            parent="account.menu_finance" sequence="5" />
		
	    <!--
        VOUCHER PAYMENT CUSTOMER
        -->
        <record model="ir.ui.view" id="of_withholding_voucher_vendor_receipt_form">
			<field name="name">of.withholding.voucher.vendor.receipt.form</field>
			<field name="model">account.voucher</field>
			<field name="inherit_id" ref="account_voucher.view_vendor_receipt_form"/>
			<field name="arch" type="xml">
			    
				<xpath expr="//field[@name='line_cr_ids']//field[@name='amount_original']" position="after">
				    <field name="amount_residual_withholding_tax" readonly="1" />
				</xpath>
				
				<xpath expr="//field[@name='line_cr_ids']//field[@name='amount']" position="attributes">
				    <attribute name="on_change">onchange_amount(amount, amount_unreconciled, amount_residual_withholding_tax, context)</attribute>
				</xpath>
				
				<xpath expr="//field[@name='line_cr_ids']//field[@name='reconcile']" position="attributes">
				    <attribute name="on_change">onchange_reconcile(reconcile, amount, amount_unreconciled, amount_residual_withholding_tax, context)</attribute>
				</xpath>
				
				<xpath expr="//field[@name='line_cr_ids']//field[@name='amount']" position="after">
				    <field name="amount_withholding_tax" attrs="{'invisible': [('amount_residual_withholding_tax', '=', 0)]}" sum="Total Amount"/>
				</xpath>
				
			</field>
		</record>
	    
	    <!--
        VOUCHER PAYMENT SUPPLIER
        -->
        <record model="ir.ui.view" id="of_withholding_voucher_payment_supplier_form">
			<field name="name">of.withholding.voucher.payment.supplier.form</field>
			<field name="model">account.voucher</field>
			<field name="inherit_id" ref="account_voucher.view_vendor_payment_form"/>
			<field name="arch" type="xml">
			    
			    <!-- Debit -->
				<xpath expr="//field[@name='line_dr_ids']//field[@name='amount_original']" position="after">
				    <field name="amount_residual_withholding_tax" readonly="1" />
				</xpath>
				
				<xpath expr="//field[@name='line_dr_ids']//field[@name='amount']" position="attributes">
				    <attribute name="on_change">onchange_amount(amount, amount_unreconciled, amount_residual_withholding_tax, context)</attribute>
				</xpath>
				
				<xpath expr="//field[@name='line_dr_ids']//field[@name='reconcile']" position="attributes">
				    <attribute name="on_change">onchange_reconcile(reconcile, amount, amount_unreconciled, amount_residual_withholding_tax, context)</attribute>
				</xpath>
				
				<xpath expr="//field[@name='line_dr_ids']//field[@name='amount']" position="after">
				    <field name="amount_withholding_tax" attrs="{'invisible': [('amount_residual_withholding_tax', '=', 0)]}" sum="Total Amount"/>
				</xpath>
				
				<!-- Credit -->
				<xpath expr="//field[@name='line_cr_ids']//field[@name='amount_original']" position="after">
				    <field name="amount_residual_withholding_tax" readonly="1" />
				</xpath>
				<xpath expr="//field[@name='line_cr_ids']//field[@name='amount']" position="attributes">
				    <attribute name="on_change">onchange_amount(amount, amount_unreconciled, amount_residual_withholding_tax, context)</attribute>
				</xpath>
				<xpath expr="//field[@name='line_cr_ids']//field[@name='reconcile']" position="attributes">
				    <attribute name="on_change">onchange_reconcile(reconcile, amount, amount_unreconciled, amount_residual_withholding_tax, context)</attribute>
				</xpath>
				<xpath expr="//field[@name='line_cr_ids']//field[@name='amount']" position="after">
				    <field name="amount_withholding_tax" attrs="{'invisible': [('amount_residual_withholding_tax', '=', 0)]}" sum="Total Amount"/>
				</xpath>
				
			</field>
		</record>
		
        <!--
        INVOICE CUSTOMER
        -->
		<record model="ir.ui.view" id="of_withholding_invoice_form">
			<field name="name">of.withholding.invoice.form</field>
			<field name="model">account.invoice</field>
			<field name="inherit_id" ref="account.invoice_form"/>
			<field name="arch" type="xml">
			    
			    <xpath expr="//field[@name='fiscal_position']" position="attributes">
				    <attribute name="on_change">onchange_fiscal_position_id(fiscal_position)</attribute>
				</xpath>
			    <xpath expr="//field[@name='journal_id']" position="after">
				    <field name="withholding_tax" on_change="onchange_fiscal_position_id(fiscal_position)"/>
				</xpath>
				
				<xpath expr="//page[@string='Invoice Lines']/group[@class='oe_subtotal_footer oe_right']" position="after">
					<div style="width: 50%%">
                        <field name="withholding_tax_line" attrs="{'invisible': [('withholding_tax', '=', False)]}">
				            <tree>
				                <field name="withholding_tax_id"/>
				            	<field name="base"/>
				            	<field name="tax"/>
				            </tree>
				            <form>
				                <group colspan="2">
					                <field name="withholding_tax_id" on_change="onchange_withholding_tax_id(withholding_tax_id, parent.invoice_line)"/>
					            	<field name="base"/>
					            	<field name="tax"/>
				            	</group>
				            </form>
                    	</field>
	                </div>
	            </xpath>
				
				
				 
				<xpath expr="//field[@name='amount_total']" position="after">
				    <field name="withholding_tax_amount" widget="monetary" options="{'currency_field': 'currency_id'}" 
				        attrs="{'invisible': [('withholding_tax', '=', False)]}"/>
				    <field name="amount_net_pay" widget="monetary" options="{'currency_field': 'currency_id'}" class="oe_subtotal_footer_separator"
				        attrs="{'invisible': [('withholding_tax', '=', False)]}"/>
				</xpath>
			    
			</field>
		</record>
		
	    <!--
        INVOICE SUPPLIER
        -->
		<record model="ir.ui.view" id="of_withholding_invoice_supplier_form">
			<field name="name">of.withholding.invoice.supplier.form</field>
			<field name="model">account.invoice</field>
			<field name="inherit_id" ref="account.invoice_supplier_form"/>
			<field name="arch" type="xml">
			     
			    <xpath expr="//field[@name='fiscal_position']" position="attributes">
				    <attribute name="on_change">onchange_fiscal_position_id(fiscal_position)</attribute>
				</xpath>
			    
			    <xpath expr="//field[@name='journal_id']" position="after">
				    <field name="withholding_tax" on_change="onchange_fiscal_position_id(fiscal_position)"/>
				</xpath>
				
				<xpath expr="//field[@name='tax_line']" position="after">
			        <field name="withholding_tax_line" attrs="{'invisible': [('withholding_tax', '=', False)]}">
			            <tree>
			                <field name="withholding_tax_id"/>
			            	<field name="base"/>
			            	<field name="tax"/>
			            </tree>
			            <form>
			                <group colspan="2">
				                <field name="withholding_tax_id" on_change="onchange_withholding_tax_id(withholding_tax_id, parent.invoice_line)"/>
				            	<field name="base"/>
				            	<field name="tax"/>
			            	</group>
			            </form>
			            <!-- 
			            <tree  editable="bottom" string="Withholding Taxes">
			            	<field name="withholding_tax_id" on_change="onchange_withholding_tax_id(withholding_tax_id, parent.withholding_tax_line, parent.invoice_line)"/>
			            	<field name="base"/>
			            	<field name="tax"/>
			            </tree>
			             -->
			        </field>
				</xpath>
				 
				<xpath expr="//field[@name='amount_total']" position="after">
				    <field name="withholding_tax_amount" widget="monetary" options="{'currency_field': 'currency_id'}" 
				        attrs="{'invisible': [('withholding_tax', '=', False)]}"/>
				    <field name="amount_net_pay" widget="monetary" options="{'currency_field': 'currency_id'}" class="oe_subtotal_footer_separator"
				        attrs="{'invisible': [('withholding_tax', '=', False)]}"/>
				</xpath>
				 
			</field>
		</record>
	    
	    <!--
        FISCAL POSITION
         -->
        <record model="ir.ui.view" id="of_withholding_tax_fiscal_position_form">
			<field name="name">of.withholding.tax.fiscal.position.form</field>
			<field name="model">account.fiscal.position</field>
			<field name="inherit_id" ref="account.view_account_position_form"/>
			<field name="arch" type="xml">
			    
				<xpath expr="//separator[@string='Taxes Mapping']" position="before">
				    <separator string="Withholding Tax"/>
			        	<field name="withholding_tax_ids" nolabel="1">
			        	    <tree editable="bottom">
			        	        <field name="name"/>
			        	        <field name="tax"/>
			        	        <field name="base"/>
			        	    </tree>
			        	</field>
				</xpath>
				
			</field>
		</record>
	    
		<!--
        WITHHOLDING TAX
         -->
        <record id="of_withholding_tax_view_tree" model="ir.ui.view">
            <field name="name">of.withholding.tax.view.tree</field>
            <field name="model">withholding.tax</field>
            <field name="arch" type="xml">
	            <tree string="Withholding Tax" version="7.0">
	            	<field name="name"/>
	            	<field name="tax"/>
	            	<field name="base"/>
	            	<field name="certification"/>
	            	<field name="active"/>
	            	<field name="comment"/>
	            </tree>
            </field>
        </record>
        
        <record id="of_withholding_tax_view_form" model="ir.ui.view">
            <field name="name">of.withholding.tax.view.form</field>
            <field name="model">withholding.tax</field>
            <field name="arch" type="xml">
            	<form string="Withholding Tax" version="7.0">
            	    <group>
		            	<group>
		            	    <field name="name"/>
			            	<field name="certification"/>
			            	<field name="account_receivable_id"/>
			            	<field name="account_payable_id"/>
			            	<field name="payment_term"/>
		            	</group>
		            	<group>
		            		<field name="active"/>
		            	</group>
	            	</group>
	            	<field name="comment"/>
	            	<newline/>
	            	<group string="Rates">
	            	    <field name="rate_ids" nolabel="1">
	            	        <tree>
	            				<field name="base"/>
	            				<field name="tax"/>
	            				<field name="date_start"/>
	            				<field name="date_stop"/>
	            	        </tree>
	            	        <form>
	            	            <group>
	            	                <group>
	            						<field name="tax"/>
	            					</group>
	            					<group>
	            						<field name="base"/>
	            					</group>
	            					<newline/>
		            				<group>
			            				<field name="date_start"/>
			            				<field name="date_stop"/>
		            				</group>
	            				</group>
	            	        </form>
	            	    </field>
	            	</group>
	            </form>
            </field>
        </record>
        
        <record id="action_of_withholding_tax" model="ir.actions.act_window">
            <field name="name">Withhoulding Tax</field>
            <field name="res_model">withholding.tax</field>
            <field name="view_id" ref="of_withholding_tax_view_tree"/>
        </record>
        
        <menuitem id="menu_of_withholding_tax" name="Withholding Tax" 
            action="action_of_withholding_tax" parent="account.menu_finance_configuration" sequence="45"/>
            
            
        <!--
        WITHHOLDING TAX STATEMENT
         -->
        <record id="of_withholding_statement_view_tree" model="ir.ui.view">
            <field name="name">of.withholding.tax.statement.view.tree</field>
            <field name="model">withholding.tax.statement</field>
            <field name="arch" type="xml">
	            <tree string="Withholding Tax statement" version="7.0">
	            	<field name="partner_id"/>
	            	<field name="date"/>
	            	<field name="move_id"/>
	            	<field name="invoice_id"/>
	            	<field name="withholding_tax_id"/>
	            	<field name="base" sum="Tot Base"/>
	            	<field name="tax"/>
	            	<field name="amount" sum="Tot Amount"/>
	            	<field name="amount_paid" sum="Tot Amount Paid"/>
	            </tree>
            </field>
        </record>
        
        <record id="of_withholding_statement_view_form" model="ir.ui.view">
            <field name="name">of.withholding.tax.statement.view.form</field>
            <field name="model">withholding.tax.statement</field>
            <field name="arch" type="xml">
	            <form string="Withholding Tax statement" version="7.0">
	            	<group>
	            		<group>
	            			<field name="partner_id"/>
	            			<field name="date"/>
	            		</group>
	            		<group>
	            			<field name="move_id"/>
	            			<field name="invoice_id"/>
	            		</group>
	            	</group>
					<newline/>	            	
	            	<group>
	            		<field name="move_ids" nolabel="1">
	            			<tree>
	            				<field name="date"/>
	            				<field name="withholding_tax_id"/>
	            				<field name="date_maturity"/>
	            				<field name="amount"/>
	            				<field name="state"/>
	            			</tree>
	            		</field>	
	            	</group>
	            </form>
            </field>
        </record>
        
        <record id="of_withholding_tax_statement_view_search" model="ir.ui.view">
            <field name="name">of.withholding.tax.statement.view.search</field>
            <field name="model">withholding.tax.statement</field>
            <field name="arch" type="xml">
                <search string="Withholding Tax Statement">
                    <field name="partner_id" filter_domain="[('partner_id','ilike',self)]"/>
                    <field name="withholding_tax_id" filter_domain="[('withholding_tax_id','ilike',self)]"/>
                    <group expand="0" string="Group By...">
                        <filter string="Partners" icon="terp-personal" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Withholding Tax" icon="terp-personal" domain="[]" context="{'group_by':'withholding_tax_id'}"/>
                        <filter string="Date" icon="terp-go-month" domain="[]" context="{'group_by':'date'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="action_of_withholding_tax_statement" model="ir.actions.act_window">
            <field name="name">Withhoulding Tax Statement</field>
            <field name="res_model">withholding.tax.statement</field>
            <field name="view_id" ref="of_withholding_statement_view_tree"/>
            <field name="search_view_id" ref="of_withholding_tax_statement_view_search" />
        </record>
        
        <menuitem id="menu_of_withholding_tax_statement" name="WT Statements" 
            action="action_of_withholding_tax_statement" parent="of_wt_main" sequence="5"/>
            
        <!--
        WITHHOLDING TAX MOVE
         -->
         <record id="of_withholding_move_view_tree" model="ir.ui.view">
            <field name="name">of.withholding.tax.move.view.tree</field>
            <field name="model">withholding.tax.move</field>
            <field name="arch" type="xml">
	            <tree string="Withholding Tax Move" version="7.0">
	            	<field name="partner_id"/>
	            	<field name="date"/>
       				<field name="withholding_tax_id"/>
       				<field name="date_maturity"/>
       				<field name="amount" sum="Tot"/>
       				<field name="account_move_id"/>
       				<field name="state"/>
	            </tree>
            </field>
        </record>
        
        <record id="of_withholding_move_view_form" model="ir.ui.view">
            <field name="name">of.withholding.tax.move.view.form</field>
            <field name="model">withholding.tax.move</field>
            <field name="arch" type="xml">
	            <form string="Withholding Tax Move" version="7.0">
	            	<header>
                        <button name="action_set_to_draft" states="paid" string="Set to Draft" type="object" />
                        <button name="action_paid" states="due" string="Paid" type="object" />
	                    <field name="state" widget="statusbar" statusbar_visible="due,paid"/>
                	</header>
                	<sheet string="Withholding Tax Move">
		            	<group>
			            	<group>
			            		<field name="partner_id"/>
			            		<field name="date"/>
			            	</group>
		            	</group>
		            	<newline/>
		            	<group>
			            	<group>
			            		<field name="withholding_tax_id"/>
	       						<field name="amount"/>
			            	</group>
			            	<group>
			            		<field name="account_move_id"/>
			            	</group>
		            	</group>
	            	</sheet>
	            </form>
            </field>
        </record>
        
        <record id="of_withholding_move_view_search" model="ir.ui.view">
            <field name="name">of.withholding.tax.move.view.search</field>
            <field name="model">withholding.tax.move</field>
            <field name="arch" type="xml">
                <search string="Withholding Tax Move">
                	<filter name="due" string="Due" domain="[('state','=','due')]" help="Due"/>
                	<filter name="paid" string="Paid" domain="[('state','=','paid')]" help="Paid"/>
                    <field name="partner_id" filter_domain="[('partner_id','ilike',self)]"/>
                    <field name="withholding_tax_id" filter_domain="[('withholding_tax_id','ilike',self)]"/>
                    <group expand="0" string="Group By...">
                        <filter string="Partners" icon="terp-personal" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Withholding Tax" icon="terp-personal" domain="[]" context="{'group_by':'withholding_tax_id'}"/>
                        <filter string="Date" icon="terp-go-month" domain="[]" context="{'group_by':'date'}"/>
                        <filter string="Date Maturity" icon="terp-go-month" domain="[]" context="{'group_by':'date_maturity'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="action_of_withholding_tax_move" model="ir.actions.act_window">
            <field name="name">Withhoulding Tax Move</field>
            <field name="res_model">withholding.tax.move</field>
            <field name="view_id" ref="of_withholding_move_view_tree"/>
            <field name="search_view_id" ref="of_withholding_move_view_search" />
        </record>
        
        <menuitem id="menu_of_withholding_tax_move" name="WT Moves" 
            action="action_of_withholding_tax_move" parent="of_wt_main" sequence="10"/>

    </data>
</openerp>
